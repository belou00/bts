---
title: Architecture & arborescence
nav_order: 4
---

# Architecture générale

## Backend
- **Express** (routes REST + pages HTML statiques)
- **MongoDB** (sièges, abonnés, saisons, tarifs)
- **JWT** (tokens de renouvellement)
- **HelloAsso** (Checkout, sandbox/prod)

## Arborescence (extrait)
src/
loaders/
express.js # construit l'app Express (CORS, helmet, static, routes)
mongo.js # connexion Mongo (MONGO_URI)
models/
Seat.js # {seasonCode, venueSlug, seatId, zoneKey, status, provisionedFor}
Subscriber.js # abonnés (flat), groupKey, prefSeatId, previousSeasonSeats
Season.js # phases (renewal, tbh7, public)
Tariff.js # catalogue des tarifs
TariffPrice.js # prix par zone/saison/lieu
routes/
index.js # routeur principal (inclut /s/renew)
renew.js # GET/POST renouvellement
admin.js # endpoints admin light (phases, exports, etc.)
public/
html/
renew.html # page de renouvellement
static/
styles/
renew.css # styles renew
venues/
<slug>/
plan.svg # plan du lieu (servi & parsing SVG)
scripts/
venues/
register-venue-with-plan.js
import-seats-from-svg.js
instantiate-seats-for-season.js
tariffs/
import-catalog.js
pricing/
import-zone-tariffs.js
renewal/
provision-seats.js
admin/
reset-db.js
upsert-season.js
export-renew-groups.js
import-subscribers-flat.js
docs/



## Points clés
- **Plan SVG** non stocké en base : servi en statique, parsé côté scripts pour générer le **catalogue de sièges** (collection `seatcatalogs`).
- Instanciation par saison → collection **`seats`**.
- Les **tokens** de renouvellement contiennent `seasonCode`, `venueSlug`, `groupKey`, `email`, **`seatIds`**.
