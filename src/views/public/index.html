<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Abonnements</title>
  <link rel="stylesheet" href="/views/css/main.css" />
  <style>
    .seat.available { cursor:pointer; }
    .seat.held { opacity: .4; }
    .seat.sold, .seat.blocked { opacity: .2; pointer-events:none; }
    .selected { outline: 2px dashed; }
  </style>
</head>
<body>
  <h1>Choisissez vos places</h1>
  <object id="arena" type="image/svg+xml" data="/static/arena.svg"></object>
  <script>
    const seasonCode = '2025-2026';
    const state = { selected: [] };
    fetch(`/api/v1/public/seats?seasonCode=${seasonCode}`).then(r=>r.json()).then(({seats})=>{
      document.getElementById('arena').addEventListener('load', ()=>{
        const svg = document.getElementById('arena').contentDocument;
        seats.forEach(s=>{
          const el = svg.getElementById(s.seatId);
          if (!el) return;
          el.classList.add('seat', s.status);
          if (s.status==='available') {
            el.addEventListener('click', ()=>{
              el.classList.toggle('selected');
              if (el.classList.contains('selected')) state.selected.push(s.seatId);
              else state.selected = state.selected.filter(x=>x!==s.seatId);
            });
          }
        });
      });
    });
  </script>
</body>
</html>
